<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Explorer</title>
<style>
  /* --- 基本样式重置和朴素背景 --- */
  body {
    /* 移除了渐变背景，使用类似Windows的浅灰色 */
    background-color: #f0f2f5; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  /* --- 滚动条样式 (保持不变) --- */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-corner {
    background-color: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: #49b1f5;
    background-image: -webkit-linear-gradient(45deg, hsla(0, 0%, 100%, .4) 25%, transparent 0, transparent 50%, hsla(0, 0%, 100%, .4) 0, hsla(0, 0%, 100%, .4) 75%, transparent 0, transparent);
    border-radius: 2em;
  }
  ::-webkit-scrollbar-track {
    background-color: rgba(73, 177, 245, .2);
    border-radius: 2em;
  }

  /* --- 主要布局容器 (使用Flexbox) --- */
  .box {
    display: flex; /* 启用Flexbox布局 */
    flex-wrap: wrap; /* 允许项目自动换行 */
    gap: 20px; /* 设置项目之间的间距 */
    padding: 20px; /* 在容器周围添加内边距 */
  }

  /* --- 单个文件项目样式 --- */
  .file-item {
    width: 160px; /* 设置每个项目的固定宽度 */
    display: flex;
    flex-direction: column; /* 垂直排列图片和文字 */
    align-items: center; /* 水平居中 */
    padding: 10px;
    border-radius: 6px; /* 轻微的圆角 */
    background-color: #ffffff; /* 白色背景 */
    border: 1px solid #e0e0e0; /* 浅灰色边框 */
    box-shadow: 0 1px 3px rgba(0,0,0,0.05); /* 微小的阴影增加立体感 */
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
  }

  .file-item:hover {
    background-color: #e6f7ff; /* 悬停时类似Windows的选中效果 */
    border-color: #91d5ff;
    transform: translateY(-2px); /* 轻微上浮效果 */
  }

  .file-item img {
    width: 120px; /* 图片宽度 */
    height: 120px; /* 固定图片高度，形成整齐的网格 */
    object-fit: cover; /* 保持图片比例，裁剪多余部分 */
    border-radius: 4px; /* 图片的轻微圆角 */
    /* 移除旧的内联样式依赖 */
    padding: 0;
    margin-left: 0;
  }
  
  .file-item .filename {
    margin-top: 8px;
    font-size: 14px;
    color: #333;
    text-align: center;
    /* 防止长文件名撑破容器 */
    word-break: break-all; 
    /* 最多显示两行，超出部分显示省略号 */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    height: 2.8em; /* 约等于两行文字的高度 */
  }

  /* --- 放大图片遮罩层 (保持不变) --- */
  #bigimg {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* 加深背景以便更专注看图 */
    z-index: 1000; /* 确保在最上层 */
  }
  #bigimg img {
    position: absolute;
    width: auto; /* 自动宽度 */
    height: auto; /* 自动高度 */
    max-width: 90%; /* 最大宽度为视口的90% */
    max-height: 90%; /* 最大高度为视口的90% */
    top: 50%;
    left: 50%;
    object-fit: contain;
    transform: translate(-50%, -50%);
    border-radius: 8px;
  }
</style>
</head>
<body>
  <div class="box">
    <!-- 图片将通过JavaScript动态插入这里 -->
  </div>
  
  <!-- 放大遮罩层 -->
  <div id="bigimg" onclick="closeBigImg();"></div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
<script>
  // AJAX请求获取图片列表 (保持不变)
  var imgList;
  $.ajax({
    url: "./api/manage/list",
    async: false,
    dataType: "json",
    success: function(data) {
      imgList = data;
    }
  });

  // --- 修改了图片生成逻辑 ---
  var targetElement = document.querySelector('.box');
  if (imgList && imgList.length > 0) {
    let str = '';
    for (let i = 0; i < imgList.length; i++) {
      if (imgList[i].name.indexOf(".mp4") > 0) continue;
      
      const imageUrl = "/file/" + imgList[i].name;
      const imageName = imgList[i].name;
      
      // 创建一个包含图片和文件名的完整文件项
      // 注意：onclick事件现在绑定在父元素div上，
      // 并通过 this.querySelector('img') 将内部的img元素传递给函数
      str += `
        <div class="file-item" onclick="showBigImg(this.querySelector('img'))">
          <img data-original="${imageUrl}" src="${imageUrl}">
          <div class="filename">${imageName}</div>
        </div>
      `;
    }
    targetElement.innerHTML = str;
  }

  // --- 删除了整个瀑布流的JavaScript逻辑 ---
  // window.onload 和 $(window).resize 事件监听器已不再需要，
  // 因为Flexbox会自动处理响应式布局。

  // --- 放大和关闭图片的函数 (保持不变) ---
  function showBigImg(img) {
    var bigImg = document.getElementById('bigimg');
    var imgUrl = img.getAttribute('data-original');
    bigImg.innerHTML = '<img src="' + imgUrl + '">';
    bigImg.style.display = 'block';
  }

  function closeBigImg() {
    var bigImg = document.getElementById('bigimg');
    bigImg.style.display = 'none';
    bigImg.innerHTML = '';
  }
</script>
</body>
</html>
